import{B as o}from"./browser-polyfill-5e752e65.js";import{u as d,v as w,E as y}from"./user-config-69ab7572.js";globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(t,a){return this.cache.has(t)?this.cache.get(t):(this.cache.set(t,a),a)}};const v={}.VITE_PLAUSIBLE_API_HOST||"https://plausible.io";async function b(t,a){await d(`${v}/api/event`,{method:"POST",body:{domain:"chathub.gg",name:t,url:location.href,props:a},mode:"no-cors"})}async function T(){const{source:t}=await d("https://chathub.gg/api/user/source",{credentials:"include"});b("install",{source:t,language:navigator.language})}var f={};/*!
 * cookie
 * Copyright(c) 2012-2014 Roman Shtylman
 * Copyright(c) 2015 Douglas Christopher Wilson
 * MIT Licensed
 */f.parse=E;f.serialize=k;var S=Object.prototype.toString,l=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/;function E(t,a){if(typeof t!="string")throw new TypeError("argument str must be a string");for(var r={},e=a||{},s=e.decode||C,n=0;n<t.length;){var i=t.indexOf("=",n);if(i===-1)break;var c=t.indexOf(";",n);if(c===-1)c=t.length;else if(c<i){n=t.lastIndexOf(";",i-1)+1;continue}var u=t.slice(n,i).trim();if(r[u]===void 0){var h=t.slice(i+1,c).trim();h.charCodeAt(0)===34&&(h=h.slice(1,-1)),r[u]=O(h,s)}n=c+1}return r}function k(t,a,r){var e=r||{},s=e.encode||A;if(typeof s!="function")throw new TypeError("option encode is invalid");if(!l.test(t))throw new TypeError("argument name is invalid");var n=s(a);if(n&&!l.test(n))throw new TypeError("argument val is invalid");var i=t+"="+n;if(e.maxAge!=null){var c=e.maxAge-0;if(isNaN(c)||!isFinite(c))throw new TypeError("option maxAge is invalid");i+="; Max-Age="+Math.floor(c)}if(e.domain){if(!l.test(e.domain))throw new TypeError("option domain is invalid");i+="; Domain="+e.domain}if(e.path){if(!l.test(e.path))throw new TypeError("option path is invalid");i+="; Path="+e.path}if(e.expires){var u=e.expires;if(!L(u)||isNaN(u.valueOf()))throw new TypeError("option expires is invalid");i+="; Expires="+u.toUTCString()}if(e.httpOnly&&(i+="; HttpOnly"),e.secure&&(i+="; Secure"),e.partitioned&&(i+="; Partitioned"),e.priority){var h=typeof e.priority=="string"?e.priority.toLowerCase():e.priority;switch(h){case"low":i+="; Priority=Low";break;case"medium":i+="; Priority=Medium";break;case"high":i+="; Priority=High";break;default:throw new TypeError("option priority is invalid")}}if(e.sameSite){var m=typeof e.sameSite=="string"?e.sameSite.toLowerCase():e.sameSite;switch(m){case!0:i+="; SameSite=Strict";break;case"lax":i+="; SameSite=Lax";break;case"strict":i+="; SameSite=Strict";break;case"none":i+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}}return i}function C(t){return t.indexOf("%")!==-1?decodeURIComponent(t):t}function A(t){return encodeURIComponent(t)}function L(t){return S.call(t)==="[object Date]"||t instanceof Date}function O(t,a){try{return a(t)}catch{return t}}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(t,a){return this.cache.has(t)?this.cache.get(t):(this.cache.set(t,a),a)}};const p="twitter-csrf-token";async function _({refresh:t}={}){if(!t){const{[p]:r}=await o.storage.session.get(p);if(r)return r}const a=await o.tabs.create({url:"https://about.twitter.com/en/404",active:!1});try{const r=await o.scripting.executeScript({target:{tabId:a.id},func:()=>document.cookie,injectImmediately:!0}),s=f.parse(r[0].result||"").ct0||"";return await o.storage.session.set({[p]:s}),s}finally{await o.tabs.remove(a.id)}}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(t,a){return this.cache.has(t)?this.cache.get(t):(this.cache.set(t,a),a)}};chrome.storage.session.setAccessLevel({accessLevel:"TRUSTED_AND_UNTRUSTED_CONTEXTS"});async function g(){const t=await o.tabs.query({}),a=o.runtime.getURL("app.html"),r=t.find(n=>{var i;return(i=n.url)==null?void 0:i.startsWith(a)});if(r){await o.tabs.update(r.id,{active:!0});return}const{startupPage:e}=await w(),s=e===y?"":`#/chat/${e}`;await o.tabs.create({url:`app.html${s}`})}o.action.onClicked.addListener(()=>{g()});o.runtime.onInstalled.addListener(t=>{t.reason==="install"&&(o.tabs.create({url:"app.html#/setting"}),T())});o.commands.onCommand.addListener(async t=>{t==="open-app"&&g()});o.runtime.onMessage.addListener(async(t,a)=>{if(t.target==="background"&&t.type==="read-twitter-csrf-token")return _(t.data)});
